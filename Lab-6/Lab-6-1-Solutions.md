# Lab6-1 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab06-01.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- What is the major code construct found in the only subroutine called by main?**

Main fonksiyonumuzdan sub_401000 adında 1 adet fonksiyon çağrılmaktadır. Bu fonksiyon incelendiğinde ise en dikkat çekici yapı **IF-ELSE** yapısıdır. Bunu da aşağıdaki ekran alıntısındaki kırmızı ile belirtilmiş kısımdan rahatlıkla görebilirsiniz. `CMP` ve `JZ` instruction'ları kullanılarak bir karar mekanizması kurulmuştur.

![](/Lab-6/images/Lab6-1-image.png "lab6")

**2- What is the subroutine located at 0x40105F?**

Belirtilen adresteki fonksiyona gittiğimiz zaman ilk dikkatimi çeken şey **\_\_stbuf** ve **\_\_ftbuf** adında 2 adet fonksiyonun kullanımıydı. Ayrıca bu subroutine'e parametre olarak, çağırmadan önce **"Succes: Internet Connection\n"** veya **"Error 1.1: No Internet\n"** stringlerinin offset değerleri verilmiştir. Aşağıda bu bahsedilen kısmın assembly kodları gösterilmiştir.

```assembly
							   jz      short loc_40102B
.text:00401017                 push    offset aSuccessInterne ; "Success: Internet Connection\n"
.text:0040101C                 call    sub_40105F
.text:00401021                 add     esp, 4
.text:00401024                 mov     eax, 1
.text:00401029                 jmp     short loc_40103A
.text:0040102B ; ---------------------------------------------------------------------------
.text:0040102B
.text:0040102B loc_40102B:                             ; CODE XREF: sub_401000+15↑j
.text:0040102B                 push    offset aError11NoInter ; "Error 1.1: No Internet\n"
.text:00401030                 call    sub_40105F
```

Bu offset değerinin verilmiş olması ve uygulamanın çalıştıktan sonra cmd ekranında bu stringleri yazdırması bana, bu subroutine'in birşeyler yazdırmak ile alakalı olduğunu düşündürdü. Daha sonra internette [bu linki](https://social.msdn.microsoft.com/Forums/vstudio/en-US/838011e2-7404-4922-989e-3ceacd6e3127/how-about-the-function-stbufstdout-woks-?forum=vclanguage) buldum. Burada `printf()` fonksiyonunun içeriğinden bahsedilmektedir. Dikkat edilirse, burada da stbuf ve ftbuf fonksiyonları kullanılmıştır. Artık bundan sonra bu subroutine'nin printf() fonksiyonu veya aynı işlevi gören bir print etme fonksiyonu olduğu sonucunu çıkarttım. Aşağıdaki görselde bu subroutine gösterilmektedir.

![](/Lab-6/images/Lab6-2-image.png "lab6")

**3- What is the purpose of this program?**

Bu programın amacı, çalıştığı sistemin internet bağlantısının olup olmadığını check etmektir.








