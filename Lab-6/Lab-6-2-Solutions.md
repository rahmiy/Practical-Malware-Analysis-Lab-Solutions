# Lab6-2 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab06-02.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- What operation does the first subroutine called by main perform?**

Çağırılan ilk subroutine'in ismi `sub401000`'dir. Yaptığı iş ise, internet bağlantısının olup olmadığını kontrol etmektir.

**2- What is the subroutine located at 0x40117F?**

Bir önceki labımız olam Lab6-1'den de hatırlayacağınız üzere bu subroutine printf() fonksiyonudur.

**3- What does the second subroutine called by main do?**

İkinci çağrılan subroutine'in ismi `sub_401040` şeklindedir. Bu subroutine, bir önceki subroutine çağrısından sonra eğer internet bağlantısı var ise çağrılmaktadır. Bir önceki subroutine olan `sub401000` internet bağlantısı var ise `EAX` registerına **1** değerini atamaktadır.

Bu subroutine, **Internet Explorer 7.5'i** kullanarak, **http://www.practicalmalwareanalysis.com/cc.htm** adresine bağlanmaya çalışmakta ve buradan **InternetReadFile** çağrısını kullanarak bir **dosya indirmeye, yada bir komut dinlemeye** çalışmaktadır. MSDN sitesinde InternetReadFile fonksiyonunun tanımı ise aşağıdaki gibidir.

> Reads data from a handle opened by the InternetOpenUrl, FtpOpenFile, or HttpOpenRequest function.

Aşağıdaki görselde ise bu subroutine ait bir kısım gösterilmektedir. Ayrıca dikkat çekici fonksiyon çağrıları ve veriler kırmızı ile belirtilmiştir.

![](/Lab-6/images/Lab6-2-image.png "lab6")

**4- What type of code construct is used in this subroutine?**

IF-ELSE yapısı kullanılmıştır.

**5- Are there any network-based indicators for this program?**

Network-based indicator;

- http://www.practicalmalwareanalysis.com/cc.htm

**6- What is the purpose of this malware?**

İlgili zararlı **http://www.practicalmalwareanalysis.com/cc.htm** adresinden bir dosya indirmeye çalışmakta ve bu dosyadan bir komutu parse etmeye denemektedir. Eğer başarılı olursa `sleep` fonksiyonu ile uykuya geçmektedir.



