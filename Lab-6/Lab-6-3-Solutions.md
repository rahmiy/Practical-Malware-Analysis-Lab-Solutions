# Lab6-3 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab06-03.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- Compare the calls in main to Lab6-2's main method. What is the new function called from main?**

Lab6-2'nin main fonskiyonu ile Lab6-3'ün main fonksiyonu karşılaştırıldığında, Lab6-3'ün main fonksiyonunda `sub_401130` adında bir fonksiyonun çağrıldığı görülmektedir.

**2- What parameters does this new function take?**

Bu yeni fonksiyon 2 adet parametre almaktadır. Bunlardan birtanesi **lpExistingFileName**, diğeri ise sub_401040 fonksiyonundan dönen değer. Aşağıdaki görselde bu değerin, ilk başta `AL` registerı ile [ebp+var_8] adresine atandığını daha sonrada bu değerin, ECX registerına `mov cl, [ebp+var_8]` komutu ile atandığını rahatlıkla görebilirsiniz.

![](/Lab-6/images/Lab6-3-image.png "lab6")

Ayrıca sub401040 fonksiyonunun içeriği incelenirse, url açılamadığında, dosya indirilemediğinde ve komut alınamadığında hep `EAX` registerının düşük byte'ı olan `AL` sıfırlanmaktadır. Yalnızca aşağıdaki görselde belirtilen kısımda `AL` registerına bir atama yapılmaktadır. Bunun dışında kalan tüm durumlarda `AL` sıfırlanmaktadır.

![](/Lab-6/images/Lab6-3-image2.png "lab6")

**3- What major code construct does this function contain?**

Burada 5 durumlu bir **switch-case** yapısı kullanılmıştır.

**4- What can this function do?**

Aşağıdaki görselde, tüm case durumları görünmektedir. Bu fonksiyonun neler yapabileceğini, çağırdığı fonksiyonlar üzerinden rahatlıkla anlayabiliriz. Olasılıkları aşağıda maddeler halinde yazıyorum.

- C: Dizininde Temp yoluna erişme
- C:\\Temp dizinine cc.exe isminde dosya kopyalama
- Bu cc.exe dosyasını silme
- Bu dosyayı `Software\Microsoft\Windows\CurrentVersion\Run` registerına `Malware` ismi ile kaydetme.
- Belirli bir saniye uykuya geçme

![](/Lab-6/images/Lab6-3-image3.png "lab6")

**5- Are there any host-based indicators for this malware?**

Aşağıdaki 2 ifade host-based indicator olarak kullanılabilir. 

- Software\\Microsoft\\Windows\\CurrentVersion\\Run {with Malware name}
- C:\\Temp\\cc.exe
- Internet Explorer 7.5/pma

**6- What is the purpose of this malware?**

Büyük bir çoğunlukla bir önceki malware ile aynı amacı gütmektedir(Lab06-02.exe). Farklı olarak parse edilen komuta göre 4. maddede belirtilen işlemleri yapmaktadır.









