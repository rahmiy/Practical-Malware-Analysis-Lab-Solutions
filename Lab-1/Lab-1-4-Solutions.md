# Lab1-4 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab01-04.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?**

Dosyamız virustotal'e yüklendiği vakit, 60 antivürüs motoru tarafından zararlı olarak algılanmıştır.

**2- Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.**

Dosyamızı PEiD ve CFF explorer ile incelediğimiz vakit bir paketleme işleminin olmadığını rahatlıkla görmekteyiz.

**3- When was this program compiled?**

Compile Time: 0x5D69A2B3 (Sat Aug 31 01:26:59 2019 - UTC)

**4- Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?**

Bir önceki dosyalarımız gibi bu dosyada da, **kernel32.dll, advapi32.dll ve msvcrt.dll** dosyaları import edilmiştir. Daha önemli olan kısım, bu dll'lerden hangi fonksiyonların import edildiğidir. Aşağıdaki görselde, dikkat çekici fonksiyonlar kırmızı ile belirtilmiştir.

![](/Lab-1/images/Lab1-4-image.png "lab4")

Buradaki WinExec komutu ile bir uygulama çalıştırılacağı aşikardır. Peki hangi uygulama çalıştırılacak? Bunu anlamak içinde .rsrc section içerisinde bulunan Executable dosyayı incelemek yeterli olacaktır. Büyük ihtimalle binary içerisinde barındırdığı bir zararlıyı WriteFile ile bir yere yazacak ve daha sonrada WinExec ile çalıştıracak. Dinamik analiz yapılmadan, yapılacak bilecek analizler bunlarla sınırlı kalacaktır. 

**5- What host or network-based indicators could be used to identify this malware on infected machines?**

Aşağıda bulunan indicatorler paylaşılmıştır.

url: http://www.practicalmalwareanalysis.com/updater.exe
The file contains another file,type: executable, location: resources, offset: 0x00004060
\system32\wupdmgr.exe
\winup.exe

**6- This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?**

Evet dosyamızı zaten CFF Explorer ile incelerseniz .rsrc section'ı içerisinde bir `executable` dosya olduğunu rahatlıkla görebilirsiniz. Bu dosyayı ayrıştırmak ve çıkartmak için **resource hacker** isimli aracı kullanacağız. Aşağıdaki gibi dosyayı import ettikten sonra, zaten resource hacker bize binary dosyayı ayrıştırıyor. Bu aşamadan sonra tek yapmanız gereken sağ tıklayıp, `save as BIN file` demeniz ve dosyayı bir yere analiz için kaydetmeniz.

![](/Lab-1/images/Lab1-4-image2.png "lab4")

Daha sonra bu çıkan binary'i Dependency Walker uygulaması ile inceledikten sonra `urlmon.dll` dosyasını import ettiğini göreceğiz. Bu dll dosyası içerisindende `URLDownloadToFileA` isimli fonksiyon import edilmiş. Bu fonksiyonun, bir önceki binary'de bulduğumuz `http://www.practicalmalwareanalysis.com/updater.exe` url ile bir bağlantısı olabilir. 