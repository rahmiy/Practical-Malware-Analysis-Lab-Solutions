# Lab1-2 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab01-02.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?**

Dosyamız virustotal'e yüklendiği vakit, 51 antivürüs motoru tarafından zararlı olarak algılanmıştır.

**2- Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.**

Dosyamızda bir paketleme işlemi olmuş gözükmektedir. Çünkü kernel32.dll, advapi32.dll, msvcrt.dll ve wininet.dll olmak üzere 4 adet dll import edilmiş lakin, bu dll'lerden import edilmiş fonksiyonlar neredeyse hiç yok gibi. Mesela dependency walker isimli uygulama ile binary analiz edildiğinde görülecektir ki; `msvcrt.dll` dosyasından import edilmiş fonksiyon olarak sadece `exit()` gözükmektedir. Ayrıca kernel32.dll dosyasından **LoadLibraryA** ve **GetProcAddress** gibi iki adet kritik fonksiyon import edilmiştir ki, bu iki fonksiyon `pack` veya `obfuscated` edilmiş binarylerde sıklıkla görülür. 

![](/Lab-1/images/Lab1-2-image.png "lab2")

Ayrıca aşağıdaki görselde dosyanın PE başlığında bulunan section headers kısmı gözükmektedir. Paketlenmiş binarylerin temel karakteristiği, herbir bölüm(section= .rsrc, .data, .text, .idata ...) için **`virtual adress > size of raw data`** özelliğini sağlamasıdır. Aşağıdaki görselde UPX0 isimli section'ın boyutu 0 byte gözükürken, RAM'de load edilecekken ayrılacak alan `0x4000` hexadecimal değeri yani 16384 byte şeklindedir. Madem alan boyutu 0 byte, neden bu kadar RAM'de yer ayrılıyor sorusunun cevabı packer'da. Ayrıca aşağıdaki görselden rahatlıkla bu binary'de `UPX packer` kullanıldığı görülmektedir. 

![](/Lab-1/images/Lab1-2-image2.png "lab2")


Aşağıdaki komut ile UPX unpacker işlemi bu binary'i için yapılabilmektedir.

<code>upx -d Lab01-02.exe -o Lab01-02-Unpacked.exe</code>

**3- Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?**

Aşağıdaki görselde zararlının bir url'ye bağlandığına dair fonksiyonlar dikakt çekmektedir. Ayrıca advapi32.dll dosyasından CreateServiceA, OpenSCManagerA gibi fonksiyonlar da, zararlının servis çalıştırmak veya servis olarak infect olduğu bilgisayara yerleşmeye çalıştığına işaret olabilir.

![](/Lab-1/images/Lab1-2-image3.png "lab2")

**4- What host or network-based indicators could be used to identify this malware on infected machines?**

Aşağıdaki indicator'ler tespit için kullanılabilir.

- http://www.malwareanalysisbook.com
- MalService
- Malservice
- HGL345
- Internet Explorer 8.0 