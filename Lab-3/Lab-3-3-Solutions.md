# Lab3-3 Sorular

Bu lab uygulamasında `Practical Malware Analysis` kitabıyla birlikte verilmiş olan `Lab03-03.exe` dosyası üzerinden analiz gerçekleştirilecek ve sorulan sorularak cevaplar verilmeye çalışılacaktır. 

Bu içeriklerin amacı, direkt olarak sorulan sorulara cevap vermek değil, aynı zamanda malware analizi konusunda aydınlatıcı ve faydalı bir içerik havuzu oluşturmaktadır. Gerektiği yerlerde detaya girilecektir. Zaten kitabı aldıysanız, kitabın bir bölümü bu soruların cevaplarını detaylı bir şekilde veriyor. Burada amaç, cevapların içerisinde gizli kalmış, değinilmesi gereken konulara da değinerek bir fayda sağlabilmek. O halde başlayalım.

İlk sorumuz,

**1- What do you notice when monitoring this malware with Process Explorer?**

Uygulamamızı Process Explorer ile incelediğimizde, Lab03-01.exe çalıştıktan bir süre sonra `svchost.exe` processinin çalıştırıldığını görmekteyiz. Aşağıdaki görselde bu işlem rahatlıkla görülmektedir.

![](/Lab-3/images/Lab3-3-image.png "lab3")

**2- Can you identify any live memory modification?**

Lab03-01.exe tarafından fork edilen `svchost.exe` processini process explorer yardımı ile biraz daha detaylı inceleyelim. İlk olarak integrity check yaparak verify etme yoluna gidelim. Çünkü bazı zararlı yazılımlar, **kendilerini gizlemek** için windows'un `built-in` uygulamalarına kendilerini kopyalarak çalışırlar. Böylelikle gözden kaçarak, varlıklarını bulaştıkları bilgisayarda sinsice devam ettirebilmektedirler.

Aşağıdaki görselde process explorer üzerinden `svchost.exe` processinin **verified** olduğu gözükmektedir. Bu işlemi process explorer, disk'te bulunan binary üzerinde yapmaktadır. Peki bu process, memory'e load edildikten sonra manipüle edildi ise? Zaten sorumuzda bizden bunu tespit etmemizi istemektedir.

![](/Lab-3/images/Lab3-3-image2.png "lab3")

Bunuda yine process explorer üzerinden tespit edebiliriz. Properties üzerinden Strings kısmına gelelim. Buradan uygulamanın hem diskteki(yani Image seçeneğindeki) hemde memory'deki stringlerini bir karşılaştıralım. Eğer bir farklılık var ise, process'e memory'de manipüle edilmiştir.

Aşağıdaki görselde farklılığı rahatlıkla görebiliriz. Yani sorumuzun cevabı bir manipülasyon olmuştur.

![](/Lab-3/images/Lab3-3-image3.png "lab3")

**3- What are the malware's host-based indicators?**

- practicalmalwareanalysis.log
- C:\WINDOWS\system32\svchost.exe

**4- What is the purpose of this program?**

Program çalıştıktan sonra svchost.exe dosyasına içeriğini kopyalayarak, kendini normal bir process gibi göstermeye çalışmaktadır. Ayrıca strings ifadeleri ve import edilmiş API'leri incelediğinizde `SetWindowsHookExA` ve `UnhookWindowsHookEx` şeklinde 2 adet fonksiyon import edilmiştir. Bu fonksiyonlar windows sistemlerde klavye girdilerini yakalamak için kullanılmaktadır. Buradan bu zararlının bir keylogger olduğu yorumunu yapabiliriz. Biraz daha incelediğimizde, string ifadelerin içerisinde `practicalmalwareanalysis.log` adında bir dosya bulunmaktadır. Bu dosyayı .exe'nin bulunduğu dizinde açıp incelediğimizde, içerisinde tuş vuruşlamızı rahatıkla görebiliriz. Özetle bu zararlı bir keyloggerdır.

Bir diğer şüphelendiğim konu ise, zararlı tarafından buffer overflow denemesinin yapılmasıdır. Bunu nereden çıkarttın diye soracak olursanız, uygulamanın birçok yerinde arka arkaya dizili birçok **A** karakteri gözükmekte. Ayrıca Procmon içerisinde aşağıdaki işlemler dikkatimi çekti. Görselde dikkat edildi ise, RegQueryValue işleminin sonucu Buffer Overflow olarak kaydedilmiştir.


![](/Lab-3/images/Lab3-3-image4.png "lab3")





